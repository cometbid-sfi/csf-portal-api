<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Keep existing head content -->
    <script>
      // Add this function to get the base URL
      function getBaseUrl() {
        return "/csf-portal-api";
      }
    </script>
  </head>
  <body>
    <div class="top-banner">
      <div class="banner-left">
        <a href="/csf-portal-api/" class="logo-link">
          <div class="logo-placeholder">TCT</div>
          <h1>TCT Foundation API Documentation</h1>
        </a>
      </div>
      <div class="api-selector">
        <label for="api-select">Select API:</label>
        <select id="api-select" onchange="loadSpec(this.value)">
          <option value="public/specs/authentication-api.yaml">
            Authentication API
          </option>
          <option value="public/specs/user-management-api.yaml">
            User Management API
          </option>
          <option value="public/specs/admin-api.yaml">Admin API</option>
        </select>
      </div>
    </div>
    <div id="swagger-ui"></div>
    <script src="https://unpkg.com/swagger-ui-dist@5.9.0/swagger-ui-bundle.js"></script>
    <script src="https://unpkg.com/swagger-ui-dist@5.9.0/swagger-ui-standalone-preset.js"></script>
    <script>
      // Initialize with the first spec
      let ui;

      function loadSpec(url) {
        // Prepend base URL if the URL doesn't already include it
        const baseUrl = getBaseUrl();
        const fullUrl = url.startsWith("http") ? url : `${baseUrl}/${url}`;

        if (ui) {
          ui.specActions.updateUrl(fullUrl);
          ui.specActions.download(fullUrl);
        } else {
          initSwaggerUI(fullUrl);
        }

        // Update URL parameter
        const newUrl = new URL(window.location);
        newUrl.searchParams.set("spec", url);
        window.history.pushState({}, "", newUrl);
      }

      function initSwaggerUI(url) {
        ui = SwaggerUIBundle({
          url: url,
          dom_id: "#swagger-ui",
          deepLinking: true,
          presets: [SwaggerUIBundle.presets.apis, SwaggerUIStandalonePreset],
          plugins: [SwaggerUIBundle.plugins.DownloadUrl],
          layout: "BaseLayout",
          docExpansion: "list",
          defaultModelsExpandDepth: 1,
          defaultModelExpandDepth: 1,
          displayRequestDuration: true,
          filter: true,
        });
      }

      window.onload = function () {
        // Check if a spec is specified in the URL
        const urlParams = new URLSearchParams(window.location.search);
        const specUrl =
          urlParams.get("spec") || "public/specs/authentication-api.yaml";

        // Set the dropdown to match the URL
        document.getElementById("api-select").value = specUrl;

        // Initialize Swagger UI with the base URL prepended
        loadSpec(specUrl);
      };
    </script>
  </body>
</html>
