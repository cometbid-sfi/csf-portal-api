<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="icon"
      type="image/png"
      href="/csf-portal-api/public/favicon-32x32.png"
      sizes="32x32"
    />
    <link
      rel="icon"
      type="image/png"
      href="/csf-portal-api/public/favicon-16x16.png"
      sizes="16x16"
    />
    <title>API Documentation</title>
    <!-- Add Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <!-- Load Swagger UI CSS first -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/swagger-ui-dist@5.9.0/swagger-ui.css"
    />
    <style>
      /* Apply professional fonts to the entire document */
      body {
        margin: 0;
        padding: 0;
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      }

      /* Override Swagger UI fonts with higher specificity */
      .swagger-ui,
      .swagger-ui .opblock .opblock-summary-operation-id,
      .swagger-ui .opblock .opblock-summary-path,
      .swagger-ui .opblock .opblock-summary-path__deprecated,
      .swagger-ui .opblock-description-wrapper p,
      .swagger-ui .info .title,
      .swagger-ui .info p,
      .swagger-ui .info li,
      .swagger-ui .tab li,
      .swagger-ui table thead tr td,
      .swagger-ui table thead tr th,
      .swagger-ui .parameters-col_description p,
      .swagger-ui .responses-inner h4,
      .swagger-ui .responses-inner h5,
      .swagger-ui .model-title,
      .swagger-ui .model {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, Oxygen, Ubuntu, Cantarell, sans-serif !important;
      }

      /* Darker blue sticky banner */
      .top-banner {
        background-color: #3a7bc8; /* Darker sky blue color */
        color: white;
        padding: 15px;
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        position: sticky;
        top: 0;
        z-index: 1000;
      }

      /* Banner left side with logo */
      .banner-left {
        display: flex;
        align-items: center;
        flex: 1;
        min-width: 200px;
        max-width: 60%; /* Add this to limit width */
      }

      /* Logo placeholder */
      .logo-placeholder {
        min-width: 40px;
        height: 40px;
        background-color: rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        margin-right: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 20px;
        flex-shrink: 0;
      }

      .logo-link {
        display: flex;
        align-items: center;
        color: white;
        text-decoration: none;
        transition: opacity 0.2s;
        max-width: 100%;
      }

      .logo-link:hover {
        opacity: 0.9;
        text-decoration: none;
      }

      .top-banner h1 {
        margin: 0;
        font-size: clamp(
          18px,
          5vw,
          24px
        ); /* Increased from 16px-20px to 18px-24px */
        font-weight: 600;
        letter-spacing: -0.5px;
        color: white;
        white-space: normal; /* Allow text to wrap */
        overflow: visible; /* Don't hide overflow */
        line-height: 1.2; /* Tighter line height for wrapped text */
        max-width: 100%; /* Ensure text doesn't overflow its container */
      }

      .api-selector {
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        margin-top: 10px;
      }

      .api-selector label {
        margin-right: 10px;
        font-weight: 500;
        font-size: 16px;
        color: white;
        white-space: nowrap;
      }

      .api-selector select {
        padding: 8px 12px;
        border-radius: 6px;
        border: 1px solid rgba(255, 255, 255, 0.3);
        background-color: rgba(255, 255, 255, 0.2);
        color: white;
        font-size: 15px;
        font-family: "Inter", sans-serif;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        max-width: 100%;
      }

      .api-selector select:hover {
        background-color: rgba(255, 255, 255, 0.3);
      }

      .api-selector select:focus {
        outline: none;
        box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.5);
      }

      #swagger-ui {
        margin: 0;
        padding-top: 20px; /* Add some space below the sticky header */
      }

      /* Improve readability of Swagger UI */
      .swagger-ui .info .title {
        font-weight: 600;
        font-size: clamp(24px, 5vw, 32px); /* Responsive font size */
      }

      .swagger-ui .opblock-tag {
        font-size: clamp(18px, 4vw, 22px); /* Responsive font size */
        font-weight: 600;
      }

      .swagger-ui .opblock .opblock-summary-operation-id,
      .swagger-ui .opblock .opblock-summary-path,
      .swagger-ui .opblock .opblock-summary-path__deprecated {
        font-size: clamp(14px, 3vw, 16px); /* Responsive font size */
      }

      /* Increase font size for description text */
      .swagger-ui .opblock-description-wrapper p,
      .swagger-ui .info p,
      .swagger-ui .info li {
        font-size: clamp(14px, 3vw, 16px); /* Responsive font size */
      }

      /* Increase font size for parameter descriptions */
      .swagger-ui .parameters-col_description p {
        font-size: clamp(13px, 3vw, 15px); /* Responsive font size */
      }

      /* Increase font size for response descriptions */
      .swagger-ui .responses-inner h4,
      .swagger-ui .responses-inner h5 {
        font-size: clamp(14px, 3vw, 16px); /* Responsive font size */
      }

      /* Media queries for better responsiveness */
      @media (max-width: 768px) {
        .top-banner {
          flex-direction: column;
          align-items: flex-start;
          padding: 15px 10px;
        }

        .banner-left {
          margin-bottom: 15px;
          width: 100%;
        }

        .api-selector {
          width: 100%;
          margin-top: 10px;
        }

        .api-selector select {
          width: 100%;
          margin-top: 5px;
        }

        .api-selector label {
          width: 100%;
          margin-bottom: 5px;
        }
      }

      /* Improve Swagger UI responsiveness */
      @media (max-width: 768px) {
        .swagger-ui .opblock-summary {
          display: flex;
          flex-direction: column;
        }

        .swagger-ui .opblock-summary-method {
          margin-bottom: 5px;
        }

        .swagger-ui .opblock-summary-path {
          word-break: break-all;
        }

        .swagger-ui .parameters-container .parameters-col_description {
          width: 100%;
        }

        .swagger-ui .parameters-container .parameters-col_name {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div class="top-banner">
      <div class="banner-left">
        <a href="/csf-portal-api/" class="logo-link">
          <div class="logo-placeholder">TCT</div>
          <h1>TCT Foundation API Documentation</h1>
        </a>
      </div>
      <div class="api-selector">
        <label for="api-select">Select API:</label>
        <select id="api-select" onchange="loadSpec(this.value)">
          <option value="public/specs/authentication-api.yaml">
            Authentication API
          </option>
          <option value="public/specs/user-management-api.yaml">
            User Management API
          </option>
          <option value="public/specs/admin-api.yaml">Admin API</option>
        </select>
      </div>
    </div>
    <div id="swagger-ui"></div>
    <script src="https://unpkg.com/swagger-ui-dist@5.9.0/swagger-ui-bundle.js"></script>
    <script src="https://unpkg.com/swagger-ui-dist@5.9.0/swagger-ui-standalone-preset.js"></script>
    <script>
      // Add this function to get the base URL
      function getBaseUrl() {
        return "/csf-portal-api";
      }

      // Initialize with the first spec
      let ui;

      function loadSpec(url) {
        // Prepend base URL if the URL doesn't already include it
        const baseUrl = getBaseUrl();
        const fullUrl = url.startsWith("http") ? url : `${baseUrl}/${url}`;

        if (ui) {
          ui.specActions.updateUrl(fullUrl);
          ui.specActions.download(fullUrl);
        } else {
          initSwaggerUI(fullUrl);
        }

        // Update URL parameter
        const newUrl = new URL(window.location);
        newUrl.searchParams.set("spec", url);
        window.history.pushState({}, "", newUrl);
      }

      function initSwaggerUI(url) {
        ui = SwaggerUIBundle({
          url: url,
          dom_id: "#swagger-ui",
          deepLinking: true,
          presets: [SwaggerUIBundle.presets.apis, SwaggerUIStandalonePreset],
          plugins: [SwaggerUIBundle.plugins.DownloadUrl],
          layout: "BaseLayout",
          docExpansion: "list",
          defaultModelsExpandDepth: 1,
          defaultModelExpandDepth: 1,
          displayRequestDuration: true,
          filter: true,
          // Add this to override Swagger UI styles
          stylesheets: [
            "https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap",
          ],
        });
      }

      window.onload = function () {
        // Check if a spec is specified in the URL
        const urlParams = new URLSearchParams(window.location.search);
        const specUrl =
          urlParams.get("spec") || "public/specs/authentication-api.yaml";

        // Set the dropdown to match the URL
        document.getElementById("api-select").value = specUrl;

        // Initialize Swagger UI with the base URL prepended
        loadSpec(specUrl);
      };
    </script>
    <script>
      // Fix broken links in the OpenAPI spec
      document.addEventListener("DOMContentLoaded", function () {
        // Wait for Swagger UI to load
        setTimeout(function () {
          // Find all links in the description
          const links = document.querySelectorAll(".swagger-ui .info a");

          // Determine if we're in production (GitHub Pages) or local development
          const isProduction = window.location.hostname.includes("github.io");
          const basePath = isProduction ? "/csf-portal-api" : "";

          links.forEach((link) => {
            // Check if it's a documentation link
            if (link.href.includes("/docs/") && link.href.includes(".html")) {
              // Get the current href
              const href = link.getAttribute("href");

              // Only modify relative links
              if ((href && href.startsWith("./")) || href.startsWith("/")) {
                // For production, add the base path
                // For local development, keep as is
                const newHref = isProduction ? `${basePath}${href}` : href;
                link.setAttribute("href", newHref);
              }
            }
          });
        }, 1500); // Wait 1.5 seconds for Swagger UI to render
      });
    </script>
  </body>
</html>
